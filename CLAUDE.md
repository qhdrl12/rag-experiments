# RAG Experiments - Claude Code Project Configuration

## 📋 프로젝트 개요

**프로젝트명**: RAG Experiments
**목적**: Retrieval-Augmented Generation 실험 및 연구 툴킷
**언어**: Python 3.12+
**패키지 관리**: uv
**테스트 프레임워크**: pytest

## 🎯 요청 처리 방식

### 1. 필수 개발 원칙 (CRITICAL RULES)
이 원칙들은 **절대** 위반할 수 없습니다:

#### 🚫 과한 추상화 금지
- **단순함 우선**: 복잡한 디자인 패턴이나 과도한 추상화 레이어 사용 금지
- **명확한 코드**: 코드 의도가 즉시 이해되어야 함
- **최소한의 복잡성**: 문제를 해결하는 가장 간단한 방법 선택
- **직관적 구조**: 3-레벨 이상의 깊은 추상화 지양

#### 🧪 테스트 기반 품질 보증 (필수)
- **모든 수정사항은 테스트로 검증**: 예외 없음
- **테스트 우선 작성**: 구현 전에 테스트 케이스 먼저 작성
- **품질 게이트**: `make quality` 명령어로 모든 변경사항 검증 필수
- **80% 커버리지**: 최소 커버리지 기준 준수

#### 📋 단계별 계획 수립 (필수)
- **작은 단위**: 각 변경사항은 리뷰 가능한 크기로 제한
- **TodoWrite 활용**: 모든 복잡한 작업은 단계별 계획 수립
- **점진적 개발**: 한 번에 하나의 개념만 변경
- **사용자 승인**: 큰 변경사항은 계획 단계에서 사용자 확인

### 2. 계획 수립 프로세스 (Plan-First Approach)

#### Phase 1: 분석 및 이해
1. **현재 상태 파악**: 코드 구조, 테스트, 의존성 분석
2. **요구사항 명확화**: 정확히 무엇을 원하는지 확인
3. **영향 범위 평가**: 변경이 미칠 수 있는 영향 분석

#### Phase 2: 계획 수립 (TodoWrite 필수)
1. **작업 분해**: 큰 작업을 리뷰 가능한 작은 단위로 분해
2. **우선순위**: 의존성 고려한 실행 순서 결정
3. **테스트 계획**: 각 단계별 검증 방법 수립
4. **위험 요소**: 잠재적 문제점과 대응 방안 식별

#### Phase 3: 사용자 승인
- **계획 공유**: TodoWrite로 생성된 계획을 사용자에게 설명
- **피드백 수집**: 방향성과 범위에 대한 확인
- **조정**: 필요시 계획 수정

#### Phase 4: 단계별 실행
- **한 번에 하나씩**: 한 Todo 항목씩 순차 실행
- **테스트 우선**: 각 단계마다 테스트 작성 → 구현 → 검증
- **품질 확인**: 각 단계 완료 후 `make quality` 실행

#### Phase 5: 최종 검증
- **통합 테스트**: 전체 시스템 동작 확인
- **성능 확인**: 성능 저하 없는지 검증
- **문서 업데이트**: 필요시 README.md, docstring 업데이트

## 🛠 개발 워크플로우

### Pre-commit 자동화
모든 커밋 전에 다음이 자동 실행됩니다:
- **포매팅**: Black, Ruff format
- **린팅**: Ruff linting
- **타입 체크**: MyPy
- **테스트**: pytest (전체 테스트 스위트)
- **기타**: 공백 정리, 파일 검증 등

### 브랜치 전략
- `main`: 안정적인 코드만 유지 (기본 브랜치)
- 기능 개발 시 별도 브랜치 사용 권장
- PR을 통한 코드 리뷰 (선택사항)

## 📁 프로젝트 구조

```
rag-expriment/
├── main.py              # 메인 애플리케이션 진입점
├── tests/               # 테스트 디렉토리
│   ├── __init__.py
│   └── test_main.py
├── pyproject.toml       # 프로젝트 설정 및 의존성
├── .pre-commit-config.yaml
├── .gitignore
├── README.md
└── CLAUDE.md           # 이 파일
```

## ⚡ Claude Code 작업 지침

### 코드 수정 시
1. **항상 Read 도구를 먼저 사용**하여 현재 코드 이해
2. **기존 패턴 유지**: 현재 코드 스타일과 구조 준수
3. **점진적 개선**: 한 번에 너무 많은 변경 금지
4. **테스트 우선**: 새 기능 구현 전 테스트 케이스 작성

### 테스트 작성 규칙
- 모든 public 함수에 대한 테스트 작성
- Edge case 및 에러 상황 테스트 포함
- 테스트 함수명은 `test_` 접두어 사용
- Arrange-Act-Assert 패턴 준수

### 의존성 관리
- 새 패키지 추가 시 `pyproject.toml` 업데이트
- `uv add {package}` 명령어 사용
- 개발용 패키지는 `uv add --dev {package}` 사용

## 🚨 작업 제약사항 (엄격히 준수)

### 절대 금지사항 (NEVER)
- ❌ **테스트 없이 구현**: 어떤 코드 변경도 테스트 없이 진행 금지
- ❌ **과도한 추상화**: Factory, Builder, Strategy 등 불필요한 패턴 사용 금지
- ❌ **대규모 변경**: 한 번에 5개 이상 파일 수정 금지
- ❌ **Pre-commit 우회**: 품질 검사 우회 시도 금지
- ❌ **계획 없는 작업**: TodoWrite 없이 복잡한 작업 진행 금지

### 반드시 해야 하는 것 (ALWAYS)
- ✅ **테스트 우선**: 구현 전 테스트 케이스 작성
- ✅ **단계별 진행**: TodoWrite로 계획 → 사용자 승인 → 단계별 실행
- ✅ **품질 확인**: 각 단계마다 `make quality` 실행
- ✅ **간단한 솔루션**: 가장 단순하고 직관적인 방법 선택
- ✅ **리뷰 가능한 크기**: 사용자가 쉽게 이해할 수 있는 크기로 작업 분할

### 코드 품질 기준
- **타입 힌트**: 모든 함수 파라미터와 리턴값에 타입 명시
- **함수 크기**: 한 함수는 최대 20줄 이내 권장
- **복잡도**: 중첩 레벨 3단계 이하 유지
- **네이밍**: 의도가 명확한 변수/함수명 사용
- **에러 처리**: 예상 가능한 에러 상황에 대한 처리 포함

### 작업 크기 가이드라인
```
🟢 작은 변경 (사용자 승인 불필요):
   - 버그 수정 (1-2 파일)
   - 함수 하나 추가
   - 테스트 케이스 추가

🟡 중간 변경 (간단한 계획 필요):
   - 새 모듈 추가
   - 기존 기능 개선
   - 3-5 파일 수정

🔴 큰 변경 (반드시 계획 + 승인):
   - 아키텍처 변경
   - 의존성 추가/제거
   - 5개 이상 파일 수정
   - 기존 API 변경
```

## 🔄 일반적인 작업 패턴

### 🟢 작은 기능 추가 (예: 단순 함수 추가)
```bash
# 1. 테스트 먼저 작성
touch tests/test_new_function.py
# 2. 테스트 케이스 구현 (실패하는 테스트)
# 3. 최소한의 코드로 테스트 통과시키기
# 4. 품질 확인
make quality
```

### 🟡 중간 크기 기능 (예: 새 모듈 추가)
```bash
# 1. TodoWrite로 계획 수립
# 2. 사용자에게 계획 설명
# 3. 단계별 실행:
#    - 테스트 작성 → 구현 → 검증 → 다음 단계
# 4. 각 단계마다 make quality 실행
```

### 🔴 큰 변경 (예: 아키텍처 변경)
```bash
# 1. 현재 상태 분석 (Read tools 활용)
# 2. TodoWrite로 상세한 단계별 계획 수립
# 3. 사용자 승인 필수
# 4. 작은 단위로 나누어 점진적 실행
# 5. 각 단계마다 통합 테스트 확인
```

### 🐛 버그 수정 패턴
```bash
# Phase 1: 문제 재현
# 1. 버그를 재현하는 테스트 케이스 작성 (실패하는 테스트)
# 2. 테스트 실행하여 버그 확인

# Phase 2: 수정
# 3. 최소한의 변경으로 테스트 통과시키기
# 4. 추가적인 엣지 케이스 테스트 작성

# Phase 3: 검증
# 5. make quality 실행
# 6. 관련 기능들의 회귀 테스트 확인
```

### 📝 리팩토링 패턴
```bash
# 반드시 다음 순서를 준수:
# 1. 현재 동작을 보장하는 테스트 작성/확인
# 2. 작은 단위로 리팩토링 (한 번에 하나의 개선사항만)
# 3. 각 단계마다 테스트 실행
# 4. 동작 변경 없이 구조만 개선
# 5. make quality로 최종 확인
```

## 📝 커밋 메시지 규칙

형식: `{type}: {description}`

**타입**:
- `feat`: 새 기능
- `fix`: 버그 수정
- `refactor`: 리팩토링
- `test`: 테스트 추가/수정
- `docs`: 문서 변경
- `style`: 코드 스타일 변경 (기능 변경 없음)
- `chore`: 빌드/설정 변경

**예시**:
```
feat: Add RAG document retrieval functionality
fix: Handle empty query in search function
test: Add comprehensive tests for embedding module
```

## 🎪 특수 요청 처리

### 대규모 리팩토링
1. **현재 상태 분석** 및 영향 범위 파악
2. **단계별 계획** 수립 (TodoWrite 활용)
3. **백워드 호환성** 고려
4. **점진적 적용** (작은 단위로 나누어 실행)

### 성능 최적화
1. **현재 성능 측정** (프로파일링)
2. **병목점 식별**
3. **최적화 전략** 수립
4. **Before/After 성능 비교**

### 새로운 아키텍처 패턴 도입
1. **기존 패턴 분석**
2. **도입 필요성 검증**
3. **점진적 마이그레이션** 계획
4. **문서화** 및 팀 공유

## 🤖 Claude Code 특별 지침

### 자동 실행 규칙
Claude Code가 이 프로젝트에서 작업할 때 자동으로 적용되는 규칙들:

1. **모든 중간 크기 이상의 작업**: TodoWrite 도구로 계획 수립 필수
2. **코드 변경 전**: 반드시 Read 도구로 현재 상태 파악
3. **구현 후**: `make quality` 명령어로 품질 확인
4. **커밋 전**: pre-commit 훅으로 최종 검증

### 🚨 3회 시도 제한 규칙 (필수 준수)
같은 방식으로 3번 실패 시 반드시 다음 프로세스를 따라야 합니다:

1. **실패 기록**: 시도 내역과 실패 원인을 상세히 분석
2. **대안 탐색**: 2-3가지 완전히 다른 접근 방법 제시
3. **근본적 재검토**:
   - 문제 분해 방식 재평가
   - 설계 방향성 재검토
   - 다른 패턴이나 기술 고려
4. **사용자 확인**: 새로운 접근법에 대한 승인 요청

#### 3회 실패 후 중단 신호
```
⚠️ 3회 시도 실패 - 접근법 재평가 필요
원인 분석: [구체적 실패 원인]
대안 1: [완전히 다른 접근법]
대안 2: [다른 기술/패턴 사용]
권장사항: [근본적 설계 변경 제안]
```

### 작업 중단 조건
다음 상황에서는 작업을 중단하고 사용자에게 확인을 요청해야 합니다:

- ❌ 5개 이상의 파일을 수정해야 하는 경우
- ❌ 새로운 의존성 패키지 추가가 필요한 경우
- ❌ 기존 API나 함수 시그니처 변경이 필요한 경우
- ❌ 복잡한 추상화 패턴 도입이 필요해 보이는 경우
- ❌ 테스트 작성이 어려운 구조로 변경해야 하는 경우
- ❌ **3회 시도 실패** (위의 3회 시도 제한 규칙 적용)

### 🤖 AI 자체 코드 리뷰 (필수 수행)
구현 완료 후 반드시 스스로 다음 체크리스트를 점검해야 합니다:

#### 📋 Core Review Checklist
- [ ] **논리적 정확성**: 코드가 의도한 대로 동작하는가?
- [ ] **에러 처리**: 예외 상황과 엣지 케이스 처리가 적절한가?
- [ ] **성능 이슈**: O(n²) 알고리즘, 메모리 누수, 불필요한 반복문은 없는가?
- [ ] **테스트 완정성**: 모든 경로와 조건이 테스트되는가?
- [ ] **타입 안정성**: 타입 힌트와 실제 동작이 일치하는가?

#### 🔍 Deep Analysis Questions
1. **이 코드를 6개월 후에 읽으면 이해할 수 있는가?**
2. **더 간단한 방법은 없었는가? 과도한 추상화를 사용하지 않았는가?**
3. **테스트하기 어려운 구조로 만들지 않았는가?**
4. **기존 프로젝트 패턴과 일관성을 유지하는가?**
5. **실패 시 디버깅하기 쉬운 구조인가?**

#### ⚡ 자체 리뷰 수행 방법
```markdown
## 🤖 자체 코드 리뷰 결과

### 발견된 문제점:
- [구체적인 문제점 나열]

### 개선 제안:
- [개선 방안 제시]

### 추가 테스트 필요:
- [누락된 테스트 케이스]

### 전체 평가: ✅ 승인 / ⚠️ 수정 필요 / ❌ 재작업
```

### 품질 보증 체크리스트
모든 작업 완료 후 다음을 확인:

- [ ] **AI 자체 코드 리뷰 완료** (위 체크리스트 수행)
- [ ] 새로운 코드에 대한 테스트 작성 완료
- [ ] `make quality` 통과 확인
- [ ] 함수별 타입 힌트 추가 확인
- [ ] 복잡도 3레벨 이하 유지 확인
- [ ] 직관적이고 명확한 코드 작성 확인

### 🎯 의사결정 우선순위 매트릭스
모든 기술적 결정은 다음 우선순위에 따라 판단해야 합니다:

#### 우선순위 순서 (1순위 → 5순위)
1. **🧪 테스트 용이성** (가장 중요)
   - 단위 테스트 작성이 쉬운가?
   - 모킹과 스텁이 간단한가?
   - 테스트 실행이 빠른가?

2. **📖 6개월 후 가독성**
   - 코드 의도가 명확한가?
   - 복잡한 로직이 잘 설명되는가?
   - 변수/함수명이 직관적인가?

3. **🔄 프로젝트 일관성**
   - 기존 패턴과 일치하는가?
   - 같은 라이브러리를 재사용하는가?
   - 코딩 스타일이 통일되는가?

4. **💎 단순함**
   - 가장 간단한 해결책인가?
   - 추상화가 과하지 않은가?
   - 코드 줄 수가 최소화되는가?

5. **🔧 변경 용이성**
   - 요구사항 변경 시 수정이 쉬운가?
   - 결합도가 낮은가?
   - 확장성이 있는가?

#### 의사결정 예시
```
Q: 새로운 기능 구현 방법 A vs B
A: 테스트 용이(5점) + 가독성(4점) + 일관성(3점) = 12점
B: 테스트 용이(2점) + 가독성(5점) + 일관성(5점) = 12점
→ 1순위(테스트 용이성)에서 A가 우수하므로 A 선택
```

### 응답 형식
작업 시작 시 반드시 다음 형식으로 응답:

```
## 📋 작업 분석
- **요청 내용**: [간단 요약]
- **영향 범위**: [파일 수, 변경 범위]
- **작업 크기**: 🟢작은/🟡중간/🔴큰 변경
- **계획 필요성**: 필요/불필요

[작업 크기가 🟡중간 이상이면 TodoWrite로 계획 수립]
```

---

**마지막 업데이트**: 2025-01-10
**Claude Code 버전 호환성**: Latest
**프로젝트 담당자**: bongkilee

> ⚠️ **중요**: 이 문서의 규칙들은 절대적이며, 예외 상황에서도 사용자 승인 없이는 위반할 수 없습니다.

- Always use descriptive variable names
